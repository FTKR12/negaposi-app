<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>ネガポジ判定アプリ (Node版)</title>
    <style>
      :root {
        --bg-gradient: radial-gradient(circle at top, #bee3f8 0, transparent 55%),
          radial-gradient(circle at bottom, #fed7e2 0, transparent 55%),
          linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #1a365d 100%);
        --card-bg: rgba(15, 23, 42, 0.88);
        --border: rgba(148, 163, 184, 0.6);
        --text-main: #e2e8f0;
        --text-muted: #94a3b8;
        --primary: #38bdf8;
        --primary-soft: rgba(56, 189, 248, 0.12);
        --positive: #4ade80;
        --negative: #fb7185;
        --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.75);
        --radius-xl: 20px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        margin: 0;
        padding: 24px 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: var(--bg-gradient);
        color: var(--text-main);
      }

      .container {
        width: 100%;
        max-width: 760px;
      }

      h1 {
        text-align: center;
        margin: 0 0 6px;
        font-size: 26px;
        letter-spacing: 0.04em;
      }

      .subtitle {
        text-align: center;
        margin-bottom: 24px;
        font-size: 13px;
        color: var(--text-muted);
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.4);
        font-size: 11px;
        color: var(--text-muted);
        margin: 0 auto 10px;
      }

      .badge-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.3);
      }

      .card {
        background: var(--card-bg);
        padding: 24px 22px 22px;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-soft);
        border: 1px solid rgba(148, 163, 184, 0.28);
        backdrop-filter: blur(18px);
        animation: fadeInUp 0.4s ease-out;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card p {
        margin-top: 0;
        margin-bottom: 18px;
        font-size: 13px;
        line-height: 1.6;
        color: var(--text-muted);
      }

      label {
        display: inline-block;
        margin-bottom: 6px;
        font-size: 13px;
        color: var(--text-main);
      }

      textarea {
        width: 100%;
        height: 130px;
        padding: 10px 11px;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.45);
        resize: vertical;
        font-size: 14px;
        font-family: inherit;
        background: rgba(15, 23, 42, 0.75);
        color: var(--text-main);
        outline: none;
        transition: border-color 0.16s ease, box-shadow 0.16s ease,
          background 0.16s ease;
      }

      textarea::placeholder {
        color: rgba(148, 163, 184, 0.8);
      }

      textarea:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.8);
        background: rgba(15, 23, 42, 0.95);
      }

      .actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 10px;
      }

      button {
        padding: 9px 20px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-size: 13px;
        font-family: inherit;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: radial-gradient(circle at top left, #38bdf8, #0ea5e9);
        color: #f9fafb;
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.8);
        transition: transform 0.12s ease, box-shadow 0.12s ease,
          opacity 0.12s ease, filter 0.12s ease;
      }

      button span.icon {
        font-size: 14px;
      }

      button:hover:not(:disabled) {
        transform: translateY(-1px);
        box-shadow: 0 16px 32px rgba(15, 23, 42, 0.9);
        filter: brightness(1.03);
      }

      button:active:not(:disabled) {
        transform: translateY(0);
        box-shadow: 0 8px 18px rgba(15, 23, 42, 0.85);
      }

      button:disabled {
        opacity: 0.6;
        cursor: default;
        box-shadow: none;
      }

      #result {
        margin-top: 18px;
        font-size: 15px;
      }

      .result-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 999px;
        background: var(--primary-soft);
        border: 1px solid rgba(56, 189, 248, 0.35);
      }

      .result-label-positive {
        color: var(--positive);
        font-weight: 600;
      }

      .result-label-negative {
        color: var(--negative);
        font-weight: 600;
      }

      .result-chip {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 3px 8px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.45);
        font-size: 11px;
        color: var(--text-muted);
      }

      .result-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: #22c55e;
      }

      .meta {
        font-size: 12px;
        color: var(--text-muted);
        margin-top: 6px;
      }

      .error {
        color: var(--negative);
        margin-top: 10px;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="badge">
        <span class="badge-dot"></span>
        <span>日本語テキストのネガポジ判定デモ</span>
      </div>

      <h1>ネガポジ判定アプリ</h1>
      <div class="subtitle">
        テキストを入力して、ポジティブ / ネガティブの雰囲気をざっくりチェックできます。
      </div>

      <div class="card">
        <p>
          テキストを入力して「判定する」を押すと、<b>ポジティブ / ネガティブ</b> を判定します。<br />
          同じテキストは DB に保存され、2回目以降は AI を呼ばずに DB から結果を返します。
        </p>

        <form id="form">
          <label for="text">テキスト:</label><br />
          <textarea
            id="text"
            name="text"
            placeholder="今日はとても楽しかった！"
          ></textarea>

          <div class="actions">
            <button id="submit-btn" type="submit">
              <span class="icon">✨</span>
              <span>判定する</span>
            </button>
          </div>
        </form>

        <div id="result"></div>
        <div id="error" class="error"></div>
      </div>
    </div>

    <script>
      const API_ENDPOINT = "/predict";

      const form = document.getElementById("form");
      const textArea = document.getElementById("text");
      const resultDiv = document.getElementById("result");
      const errorDiv = document.getElementById("error");
      const submitBtn = document.getElementById("submit-btn");

      const setLoadingState = (isLoading) => {
        submitBtn.disabled = isLoading;
        submitBtn.querySelector("span:nth-child(2)").textContent = isLoading
          ? "判定中..."
          : "判定する";
      };

      const resetMessages = () => {
        errorDiv.textContent = "";
        resultDiv.textContent = "";
      };

      const renderResult = (label, fromCache) => {
        const isPositive = label === "positive";
        const labelClass = isPositive
          ? "result-label-positive"
          : "result-label-negative";
        const labelJa = isPositive ? "ポジティブ" : "ネガティブ";
        const sourceText = fromCache ? "DB（キャッシュ）" : "AIモデル";

        resultDiv.innerHTML = `
          <div class="result-pill">
            <span>判定結果:</span>
            <span class="${labelClass}">${labelJa}</span>
            <span class="result-chip">
              <span class="result-dot"></span>
              <span>${sourceText}</span>
            </span>
          </div>
          <div class="meta">
            入力テキスト: 「${textArea.value
              .trim()
              .replace(/"/g, "&quot;")}」
          </div>
        `;
      };

      const renderError = (message) => {
        errorDiv.textContent =
          message || "エラーが発生しました。コンソールを確認してください。";
      };

      const handleSubmit = async (event) => {
        event.preventDefault();
        resetMessages();

        const text = textArea.value.trim();
        if (!text) {
          renderError("テキストを入力してください。");
          return;
        }

        setLoadingState(true);

        try {
          const response = await fetch(API_ENDPOINT, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ text }),
          });

          const data = await response.json().catch(() => null);

          if (!response.ok || !data) {
            renderError(data?.error);
            return;
          }

          renderResult(data.label, data.fromCache);
        } catch (error) {
          console.error(error);
          renderError("通信エラーが発生しました。");
        } finally {
          setLoadingState(false);
        }
      };

      form.addEventListener("submit", handleSubmit);
    </script>
  </body>
</html>
